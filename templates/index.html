<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Command Output Stream</title>
    <style>
        /* Basic reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        padding-top: 20px; /* Add some top padding */
        background: url('https://images.pexels.com/photos/73873/star-clusters-rosette-nebula-star-galaxies-73873.jpeg?cs=srgb&dl=pexels-pixabay-73873.jpg&fm=jpg') no-repeat center center fixed;
        background-size: cover;
        font-family: Arial, sans-serif;
        color: #fff;
    }

    .container {
        text-align: center;
        background-color: rgba(0, 0, 0, 0.55);
        padding: 20px;
        border-radius: 10px;
        box-shadow: inset 0 6px 12px rgba(255, 255, 255, 0.1), inset 0 -6px 12px rgba(0, 0, 0, 0.5);
        width: 80%;
        max-width: 800px;
        overflow: hidden; /* Prevent overflow */
    }

        /* Logo styling */
        .logo {
            width: 100px;
            margin-bottom: 15px;
            filter: drop-shadow(0px 4px 4px rgba(0, 0, 0, 0.5));
        }

        /* Title styling */
        h1 {
            font-size: 28px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.7), 0 0 20px rgba(0, 128, 128, 0.5);
            margin-bottom: 20px;
        }

        /* Button styling */
        button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: #3498db;
            color: white;
            transition: background-color 0.3s ease, box-shadow 0.2s;
            box-shadow: inset 0 4px 6px rgba(0, 0, 0, 0.4), inset 0 -4px 6px rgba(255, 255, 255, 0.1);
        }

        .active-button {
            background-color: #27ae60 !important;
            box-shadow: inset 0 4px 6px rgba(0, 128, 0, 0.6), inset 0 -4px 6px rgba(255, 255, 255, 0.1);
        }

        button:hover {
            background-color: #2980b9;
        }

        #output {
            white-space: pre-wrap;
            border: 1px solid #fff;
            padding: 15px;
            text-align: left;
            width: 100%;
            height: 315px;
            overflow-y: hidden;
            background-color: #222;
            color: #0f0;
            border-radius: 5px;
            margin-top: 15px;
            font-size: 15px;
            box-shadow: inset 0 4px 10px rgba(0, 0, 0, 0.7), inset 0 -4px 10px rgba(0, 255, 0, 0.3);
            scrollbar-width: none; /* Firefox */
        }

        #output::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Edge */
        }

        .value-display {
            margin-top: 10px;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div class="container">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQFQMk0tIdxo1l-osvgEvPmgbHTK49nTyYwMw&s" alt="Logo" class="logo">
        <h1>Yuvaan Command Centre</h1>
        <button onclick="startStream(this, 'trace_route')">Start</button>
        <button onclick="startStream(this, 'ping_localhost')">Mode Change</button>
        <div class="value-display">
            <h2>Current Values:</h2>
            <div>vel_linear_x: <span id="vel-linear-x">0</span></div>
            <div>vel_angular_z: <span id="vel-angular-z">0</span></div>
            <div>mode: <span id="mode">0</span></div>
            <div>ra_1: <span id="ra-1">0</span></div>
            <div>ra_2: <span id="ra-2">0</span></div>
            <div>ra_3: <span id="ra-3">0</span></div>
            <div>ra_4: <span id="ra-4">0</span></div>
            <div>ra_5: <span id="ra-5">0</span></div>
            <div>ra_6: <span id="ra-6">0</span></div>
            <div>ba_1: <span id="ba-1">0</span></div>
            <div>ba_2: <span id="ba-2">0</span></div>
            <div>ba_3: <span id="ba-3">0</span></div>
            <div>ba_4: <span id="ba-4">0</span></div>
            <div>ba_5: <span id="ba-5">0</span></div>
            <div>ba_6: <span id="ba-6">0</span></div>
        </div>
        <div id="output"></div>
    </div>
    <script>
        let eventSource;
        let activeButton;
        let outputLines = [];
        let velLinearX = document.getElementById("vel-linear-x");
        let velAngularZ = document.getElementById("vel-angular-z");
        let modeValue = document.getElementById("mode");
        let ra1Value = document.getElementById("ra-1");
        let ra2Value = document.getElementById("ra-2");
        let ra3Value = document.getElementById("ra-3");
        let ra4Value = document.getElementById("ra-4");
        let ra5Value = document.getElementById("ra-5");
        let ra6Value = document.getElementById("ra-6");
        let ba1Value = document.getElementById("ba-1");
        let ba2Value = document.getElementById("ba-2");
        let ba3Value = document.getElementById("ba-3");
        let ba4Value = document.getElementById("ba-4");
        let ba5Value = document.getElementById("ba-5");
        let ba6Value = document.getElementById("ba-6");

        function startStream(button, command) {
            if (eventSource) {
                eventSource.close();
            }

            if (activeButton) {
                activeButton.classList.remove("active-button");
            }

            activeButton = button;
            activeButton.classList.add("active-button");

            eventSource = new EventSource(`/stream_command/${command}`);
            eventSource.onmessage = function(event) {
                const data = JSON.parse(event.data);

                // Add new line to outputLines
                outputLines.push(data.output);

                // Limit to the last 20 lines
                if (outputLines.length > 20) {
                    outputLines.shift(); // Remove the oldest line
                }

                // Update the output display
                const outputDiv = document.getElementById("output");
                outputDiv.innerText = outputLines.join("\n");

                // Jump to the last line immediately
                outputDiv.scrollTop = outputDiv.scrollHeight;

                // Update the values if they exist
                if (data.vel_linear_x !== null) {
                    velLinearX.innerText = data.vel_linear_x;
                }
                if (data.vel_angular_z !== null) {
                    velAngularZ.innerText = data.vel_angular_z;
                }
                if (data.mode !== null) {
                    modeValue.innerText = data.mode;
                }
                if (data.ra_1 !== null) {
                    ra1Value.innerText = data.ra_1;
                }
                if (data.ra_2 !== null) {
                    ra2Value.innerText = data.ra_2;
                }
                if (data.ra_3 !== null) {
                    ra3Value.innerText = data.ra_3;
                }
                if (data.ra_4 !== null) {
                    ra4Value.innerText = data.ra_4;
                }
                if (data.ra_5 !== null) {
                    ra5Value.innerText = data.ra_5;
                }
                if (data.ra_6 !== null) {
                    ra6Value.innerText = data.ra_6;
                }
                if (data.ba_1 !== null) {
                    ba1Value.innerText = data.ba_1;
                }
                if (data.ba_2 !== null) {
                    ba2Value.innerText = data.ba_2;
                }
                if (data.ba_3 !== null) {
                    ba3Value.innerText = data.ba_3;
                }
                if (data.ba_4 !== null) {
                    ba4Value.innerText = data.ba_4;
                }
                if (data.ba_5 !== null) {
                    ba5Value.innerText = data.ba_5;
                }
                if (data.ba_6 !== null) {
                    ba6Value.innerText = data.ba_6;
                }
            };

            eventSource.onerror = function() {
                document.getElementById("output").innerText += "\nError: Could not retrieve data.\n";
                eventSource.close();
            };
        }
    </script>
</body>
</html>
